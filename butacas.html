<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CinexUnidos - Venezuela</title>
</head>

<style>

.cine-cont {
  display:flexbox;
  justify-content: center;
  flex-direction: column; /* Cambiamos a columna */
  align-items: center;
  height: 10px; /* ajusta el alto según sea necesario */
  margin: 0 auto; /* centra el contenedor horizontalmente */
  padding-top: 20px; /* Agregamos espacio entre el borde superior y el contenido */
}

#cines {
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  gap: 20px; /* Agregamos espacio entre los botones */
  margin-top: 20px; /* Agregamos espacio entre el borde superior y los cines */
}

.containe, .containe2 {
  margin: 0 auto; /* centra el contenedor horizontalmente */
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#Cartelera, #Salas {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#seat-container {
  margin: 40px auto; /* Agregamos espacio entre el contenedor y el borde */
  display: flex;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  gap: 10px;
  width: 90vw; /* Establece la anchura del contenedor en 90% de la anchura de la pantalla */
  max-width: 90vw; /* Establece un límite máximo de anchura de 90% de la anchura de la pantalla */
  overflow-x: auto;
}

.centro-comercial {
  display: flex;
  flex-direction: column; /* Cambiamos a columna */
  padding: 10px 20px;
  border: none;
  border-radius: 10px;
  background-color: #46b5e9;
  cursor: pointer;
  transition: background-color 0.3s ease;
  margin-bottom: 20px; /* Agregamos espacio entre los elementos */
  width: 250px; /* Establece el ancho del elemento */
  height: 250px; /* Establece el alto del elemento */
   
  justify-content: center; /* Centramos el contenido horizontalmente */
  align-items: center; /* Centramos el contenido verticalmente */
}

.centro-comercial:hover {
  background-color: #d32b63;
}

.centro-comercial img {
  width: 100px; /* Ajusta el ancho de la imagen */
  height: 100px; /* Ajusta el alto de la imagen */
  margin-top: 20px; /* Agrega espacio entre la imagen y el texto */
  margin-bottom: 10px; /* Agrega espacio entre la imagen y el texto */
  transition: transform 0.3s ease;
}

.centro-comercial:hover img {
  transform: scale(1.2);
}

.nombre-cc {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
  text-align: center; /* Centramos el texto */
}

#Cartelera {
  display: flex;
  flex-direction: row;
  gap: 20px; /* Agregamos espacio entre los botones */
}

.Pelis {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 15%;
  margin: 10px;
  padding: 10px;
  background-color: #c58337;
  color: white;
  border: none;
  border-radius: 5px;
  text-align: center;
  cursor: pointer;
  transition: background-color 0.3s;
  align-self: center; /* Centramos el botón verticalmente */
}

.Pelis:hover {
    background-color: #d1271b; /* Cambiamos el color al pasar el ratón */
  }

.Pelis img {
    margin-bottom: 5px; /* Espacio entre la imagen y el texto */
    max-width: 100%; /* Ajusta el ancho de la imagen */
    height: auto; /* Ajusta la altura de la imagen proporcionalmente */
  }

 .confirm-container {
  display: none; /* Ocultar por defecto */
  position: absolute; /* Posicionar absolutamente */
  top: 50%; /* Centrar verticalmente */
  left: 50%; /* Centrar horizontalmente */
  transform: translate(-50%, -50%); /* Corregir posición */
  background: white; /* Agregar fondo blanco */
  padding: 20px}

.confirm-container.show {
  display: block; /* Mostrar cuando se llama a la función MostrarConfirmar */
}
  .seat-button {
  width: 30px;
  height: 30px;
  margin: 5px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.seat-button.occupied {
  background-color: #000000; /* Color para asientos ocupados */
}

.seat-button.empty {
  
  background-color: #B88722; /* Color para asientos vacíos */
  color: #B88722; /* Color del texto para asientos vacíos */
  font-size: 12px; /* Tamaño del texto para asientos vacíos */
}

.containe, .containe2 {
  margin: 0 auto; /* centra el contenedor horizontalmente */
  display: flex; /* agrega display flex */
  flex-direction: row; /* coloca los elementos lado a lado */
  height: 100vh;
}

#seat-container {
 
  display: none;
  justify-content: center;
  flex-wrap: wrap;
  align-items: center;
  gap: 10px;
  width: 90vw; /* Establece la anchura del contenedor en 90% de la anchura de la pantalla */
  max-width: 90vw; /* Establece un límite máximo de anchura de 90% de la anchura de la pantalla */
  overflow-x: auto;
}

#Butacas {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  flex-grow: 1; 
  max-height: 500px;
  overflow-y: auto; 
}

.reserve-button {
  margin-top: 1rem;
  background-color: #3612da;
  color: #fff;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  
}



.reserve-button:hover {
  background-color: #060713; /* Cambiar color al pasar el ratón */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Agregar sombra para que sobresalga */
}


.reserve-button2 {
  margin-top: 1rem;
  background-color: #da1212;
  color: #fff;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  
}



.reserve-button2:hover {
  background-color: #060713; /* Cambiar color al pasar el ratón */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Agregar sombra para que sobresalga */
}



</style>




<body>
    
      
      <div class="cine-cont" >
        <div id="cines" class="cines">
          <!-- Aquí se renderizarán los elementos de cine -->
        </div>
      </div> 
      <div class="containe" id="conatainerTotal"> 
        <div id="Cartelera" class="Cartelera">     
               
    </div>
    <div class="containe2" id="conatainerTota2">  
        <div id="Salas" class="Salas">             
    </div>

    <div id="seat-container" style="width: 1200px; height: 600px; margin: 40px auto; background-color: #B88722; padding: 20px; border: 1px solid #ccc; border-radius: 10px;">
      <!-- Contenido de los asientos -->
       
      <div id="Butacas"></div>
    </div>
    <button id="reserve-button" class="reserve-button" style="display: none;">Reservar</button>

    <script>
        
        const urlBase = "https://cinexunidos-production.up.railway.app";
        const cineCont = document.getElementById('cines');
        const CarteleraCont = document.getElementById('Cartelera');
        const salasCont = document.getElementById('Salas');
        const seatContainer = document.getElementById('Butacas');
        let selectedSeats = [];
        let  selectedSeatsCancel=[];
        let PelisNoRepetidas=[];
        let Salas=[];
        let horas=[];



  fetch(`${urlBase}/theatres`)
  .then(response => response.json())
  .then(data => {
    data.forEach(element => {
      const centroComercial = document.createElement('button');
      centroComercial.className = 'centro-comercial';

      const nombreCC = document.createElement('span');
      nombreCC.className = 'nombre-cc';
      nombreCC.textContent = element.name;
      centroComercial.appendChild(nombreCC);

      let imagenSrc;
      switch (element.name) {
        case 'Sambil Chacao':
          imagenSrc = 'https://oceandrive.com.ve/wp-content/uploads/2023/01/Sambil.png';
          break;
        case 'Sambil La Candelaria':
          imagenSrc = 'https://mmedia.eluniversal.com/19326/sambil-la-candelaria-116035.jpg';
          break;
        case 'Tolón Fashion Mall':
          imagenSrc = 'https://ceovenezuela.com/wp-content/uploads/2021/12/CEOVenezuela-El-Tolon-Fashion-Mall-celebra-incorporacion-de-26-nuevos-aliados-comerciales-FOTO-800x445.jpg';
          break;
        default:
          imagenSrc = 'https://static3.depositphotos.com/1009701/256/i/450/depositphotos_2561504-stock-photo-new-strip-mall.jpg';
      }

      const imagenCC = document.createElement('img');
      imagenCC.src = imagenSrc;
      imagenCC.width = 20; // ajusta el ancho de la imagen según sea necesario
      imagenCC.height = 20; // ajusta el alto de la imagen según sea necesario
      centroComercial.appendChild(imagenCC);

      centroComercial.addEventListener('click', () => {
        Mostrar_Pelis(element.id);
        Ocultar();
      });

      cines.appendChild(centroComercial);
      console.log(element);
    });
  });




function Ocultar() {
  const cineCont = document.querySelector('.cine-cont');
  cineCont.style.display = 'none';
}


function Ocultar2() {
  const CarteleraButtons = document.querySelectorAll('#Cartelera button');
  CarteleraButtons.forEach(button => {
    button.style.display = 'none';
  });
}

function Ocultar3() {
  const salasButtons = document.querySelectorAll('#Salas button');
  salasButtons.forEach(button => {
    button.style.display = 'none';
  });

  const salaNames = document.querySelectorAll('.sala-name');
  salaNames.forEach(salaName => {
    salaName.style.display = 'none';
  });
}



function Ocultar4() {
  const buttons = document.getElementsByName(`Reservar`);
  const buttons2 = document.getElementsByName(`Cancelar`);

  buttons.forEach(button => button.style.display = 'none');
  buttons2.forEach(button => button.style.display = 'none');
}

function Mostrar_Pelis(Cineid) {
  console.log(Cineid);
  fetch(`${urlBase}/theatres/${Cineid}/auditoriums`)
  .then(response => response.json())
  .then(data => {
    const peliculas = [];
    data.forEach(element => {
      element.showtimes.forEach(showtime => {
        const pelicula = {
          name: showtime.movie.name,
          runningTime: showtime.movie.runningTime,
          rating: showtime.movie.rating
        };
        peliculas.push(pelicula);
      });
    });
    PelisNoRepetidas = [...new Set(peliculas.map(pelicula => JSON.stringify(pelicula)))].map(pelicula => JSON.parse(pelicula));
    console.log(PelisNoRepetidas); // Array con objetos de películas
    PelisNoRepetidas.forEach(pelicula => {
  const button = document.createElement('button');
  button.classList.add('Pelis'); 
  

  const img = document.createElement('img');
  data.forEach(element => {
    element.showtimes.forEach(showtime => {
      if (showtime.movie.name === pelicula.name) {
        img.src = `${urlBase}/${showtime.movie.poster}`;
        img.alt = pelicula.name;
        img.width = 200;
        img.height = 200;
        img.style.margin = '0 auto';
      }
    });
  });
  
  // Agregamos la imagen al botón
  button.appendChild(img);
  
  // Creamos un elemento span para el texto
  const textSpan = document.createElement('span');
  textSpan.textContent = `${pelicula.name} - ${pelicula.runningTime} minutos - Rating: ${pelicula.rating}`;
  textSpan.style.fontSize = '12px';
  textSpan.style.color = '#333';
  textSpan.style.textAlign = 'center';
  
  // Agregamos el texto al botón
  button.appendChild(textSpan);
  
  // Agregamos los atributos y eventos al botón
  button.addEventListener('click', () => {
    Ocultar2();
    Mostrar_Salas(pelicula.name, Cineid);
  });
  
  CarteleraCont.appendChild(button);
});
  });
}



function Mostrar_Salas(nombre, Cineid) {
  console.log(nombre);
  document.getElementById('seat-container').style.visibility = 'visible';

  fetch(`${urlBase}/theatres/${Cineid}/auditoriums`)
  .then(response => response.json())
  .then(data => {
      const salas = {};
      data.forEach(element => {
        element.showtimes.forEach((showtime, index) => {
          if (nombre === showtime.movie.name) {
            const salaName = element.name;
            const hora = showtime.startTime;
            if (!salas[salaName]) {
              salas[salaName] = [];
            }
            salas[salaName].push(hora);
            salas[salaName].push({ // Asignar objeto con datos adicionales
              showtimeId: showtime.id,
              auditoriumId: element.id,
              nombrecine:Cineid,
              nombrepeli:nombre
            });
          }
        });
      });

      // Crear sección de salas
      
      salasCont.innerHTML = ''; // Limpiar sección de salas

      // Crear botones con horas para cada sala
      Object.keys(salas).forEach(salaName => {
        const salaDiv = document.createElement('div');
        salaDiv.textContent = ` ${salaName}`;
        salaDiv.className = 'sala-name';
        salasCont.appendChild(salaDiv);

        const horasDiv = document.createElement('div');
        salas[salaName].forEach((hora, index) => {
          if (typeof hora === 'string') { // Verificar si es una hora o un objeto con datos adicionales
            const horaButton = document.createElement('button');
            horaButton.textContent = hora;
            horaButton.data = salas[salaName][index + 1]; // Asignar objeto con datos adicionales
            horaButton.addEventListener('click', event => {
              const { showtimeId, auditoriumId, nombrecine, nombrepeli} = event.target.data;
              
              Ocultar3();
              Mostrar_butacas(salaName, hora, showtimeId, auditoriumId, nombrecine, nombrepeli);
            });
            horasDiv.appendChild(horaButton);
          }
        });
        salasCont.appendChild(horasDiv);
      });
    });
}


function Mostrar_butacas(salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  console.log(salaName, hora, showtimeId, auditoriumId, Cineid, nombre)
  suscribirseAActualizaciones(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
  document.getElementById('seat-container').style.display = 'flex';
  // Agregar título y detalles de la película
  const titleElement = document.createElement('h2');
  titleElement.textContent = nombre;
  document.getElementById('seat-container').appendChild(titleElement);

  const detailsElement = document.createElement('p');
  detailsElement.textContent = `${salaName} - Hora: ${hora}`;
  document.getElementById('seat-container').appendChild(detailsElement);

   fetch(`${urlBase}/theatres/${Cineid}/auditoriums/${auditoriumId}/showtimes/${showtimeId}`)
 .then(response => response.json())
 .then(data => {
    console.log(data)
    let index ;
    let index2;
    const seatLetters = Object.keys(data.seats);
    const seatContainer = document.getElementById('Butacas');
    seatContainer.innerHTML = ''; // Limpiar contenedor de asientos

    // Crear contenedor de filas
    const rowContainer = document.createElement('div');
    rowContainer.style.display = 'flex';
    rowContainer.style.flexWrap = 'wrap';
    seatContainer.appendChild(rowContainer);

    // Iterar sobre las letras
    seatLetters.forEach(seatLetter => {
      index = 0;
      index2=0;
      const rowContainer = document.createElement('div');
      rowContainer.style.display = 'flex';
      rowContainer.style.flexWrap = 'wrap';
      seatContainer.appendChild(rowContainer);

      const seatArray = data.seats[seatLetter];
      
      seatArray.forEach(seat => {
        const seatId = `${seatLetter}${seat}`;
        if (seat == 0) {
          console.log(`${seatLetter}${index}`);
          const button = document.createElement('button');
         
          button.style.backgroundColor = 'green';
          button.textContent = `${seatLetter}${index}`;
          const asiento=`${seatLetter}${index+index2}`;
          button.name =(`${asiento}`); 
          
          button.addEventListener('click', event => {
              
            const currentButton = event.target; // Obtienes la referencia del botón que se ha clickeado
            const buttonColor = currentButton.style.backgroundColor;
            
             if (buttonColor === 'green') {if (!selectedSeatsCancel || selectedSeatsCancel.length === 0){
                 currentButton.style.backgroundColor = 'blue';
                 if (!selectedSeats || selectedSeats.length === 0) {
                  MostrarConfirmar(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
                  selectedSeats.push(asiento);
                 } else {
                   selectedSeats.push(asiento); 
                 }}
                 else {alert('Para reservar tiene que Finalizar la cancelacion de reserva');}
                 
                                          } 
             else   {if (!selectedSeats || selectedSeats.length === 0)
                 {currentButton.style.backgroundColor = 'blue';
                 if (!selectedSeats || selectedSeats.length === 0) {
                  MostrarCancelarReserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
                  selectedSeatsCancel.push(asiento);
                 } else {
                  selectedSeatsCancel.push(asiento); 
                 }}
                 else {alert('Para cancelar la reserva tiene que Finalizar la  de reserva');}

                      } 
              })
          button.className = 'seat-button';
          rowContainer.appendChild(button);
          index++;
        } else if (seat === 2) {
          console.log(`${seatLetter}${index}`);
          const button = document.createElement('button');
          
          const asiento=`${seatLetter}${index+index2}`;
          button.name =(`${asiento}`);
          button.className = 'seat-button';
          button.style.backgroundColor = 'red';
          button.textContent = `${seatLetter}${index}`;
          button.addEventListener('click', event => {
            
              
            const currentButton = event.target; // Obtienes la referencia del botón que se ha clickeado
            const buttonColor = currentButton.style.backgroundColor;

            if (buttonColor === 'green') {
              if (!selectedSeatsCancel || selectedSeatsCancel.length === 0){
                 currentButton.style.backgroundColor = 'blue';
                 if (!selectedSeats || selectedSeats.length === 0) {
                  MostrarConfirmar(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
                  selectedSeats.push(asiento);
                 } else {
                   selectedSeats.push(asiento); 
                 }}
                 
               else {alert('Para reservar tiene que Finalizar la cancelacion de reserva');}} 


             else   {if (!selectedSeats || selectedSeats.length === 0)
                 {currentButton.style.backgroundColor = 'blue';
                 if (!selectedSeats || selectedSeats.length === 0) {
                  MostrarCancelarReserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
                  selectedSeatsCancel.push(asiento);
                 } else {
                  selectedSeatsCancel.push(asiento); 
                 }}
                 else {alert('Para cancelar la reserva tiene que Finalizar la  de reserva');}
                      } })
          rowContainer.appendChild(button);
          index++;
        } else {
          console.log(`${seatLetter}${index}`);
          const button = document.createElement('button');
          button.textContent = `A0`;
          button.textContent = ' '; // Agregar un espacio en blanco para indicar asiento vacío
          index2++;
          button.className = 'seat-button empty';
          rowContainer.appendChild(button);
        }
      });
    });
  });
}

function MostrarConfirmar(salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  
  const reserveButton = document.createElement('button');
  reserveButton.textContent = 'Reservar';
  reserveButton.name ='Reservar';
  reserveButton.className = 'reserve-button'; // Agregamos la clase reserve-button
  reserveButton.style.margin = '20px auto'; // Agregar margen para que sobresalga
  reserveButton.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.2)'; // Agregar sombra para que sobresalga
  reserveButton.style.position = 'absolute'; // Posicionar absolutamente
  reserveButton.style.left = '40%'; // Centrar horizontalmente
  reserveButton.style.transform = 'translate(-50%, -50%)'; // Corregir posición
  
  reserveButton.addEventListener('click', () => {
    Realiza_Reserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
    selectedSeats.length = 0;
  });

  document.body.appendChild(reserveButton); // Agregamos el botón al body

  const cancelButton = document.createElement('button');
  cancelButton.textContent = 'Cancelar';
  cancelButton.name ='Cancelar';
  cancelButton.className = 'reserve-button2'; 
  cancelButton.style.margin = '20px auto'; // Agregar margen para que sobresalga
  cancelButton.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.2)'; // Agregar sombra para que sobresalga
  cancelButton.style.position = 'absolute'; // Posicionar absolutamente
  cancelButton.style.left = '60%'; // Centrar horizontalmente
  cancelButton.style.transform = 'translate(-50%, -50%)'; // Corregir posición
 

  cancelButton.addEventListener('click', () => {
    selectedSeats.forEach((seat) => {
    const button = document.getElementsByName(`${seat}`)[0];
    button.style.backgroundColor = 'green';
    

    // Ocultar los botones de confirmar y cancelar
    reserveButton.style.display = 'none';
    cancelButton.style.display = 'none';
    
  });
  selectedSeats.length = 0;
  });

  document.body.appendChild(cancelButton); // Agregamos el botón al body
}

function MostrarCancelarReserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  const cancelButton2 = document.createElement('button');
  cancelButton2.textContent = 'Cancelar Reserva';
  cancelButton2.name ='Cancelar';
  cancelButton2.className = 'reserve-button2'; 
  cancelButton2.style.margin = '20px auto'; // Agregar margen para que sobresalga
  cancelButton2.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.2)'; // Agregar sombra para que sobresalga
  cancelButton2.style.position = 'absolute'; // Posicionar absolutamente
  cancelButton2.style.left = '40%'; // Centrar horizontalmente
  cancelButton2.style.transform = 'translate(-50%, -50%)'; // Corregir posición
  
  cancelButton2.addEventListener('click', () => {
    Cancelar_Reserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre);
    cancelButton2.style.display = 'none';
    noCancelButton.style.display = 'none';
    selectedSeatsCancel.length = 0;
    Ocultar4();
  });

  document.body.appendChild(cancelButton2); // Agregamos el botón al body

  const noCancelButton = document.createElement('button');
  noCancelButton.textContent = 'No Cancelar';
  noCancelButton.name ='Reservar';
  noCancelButton.id ='Reservar';
  noCancelButton.className = 'reserve-button'; // Agregamos la clase reserve-button
  noCancelButton.style.margin = '20px auto'; // Agregar margen para que sobresalga
  noCancelButton.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.2)'; // Agregar sombra para que sobresalga
  noCancelButton.style.position = 'absolute'; // Posicionar absolutamente
  noCancelButton.style.left = '60%'; // Centrar horizontalmente
  noCancelButton.style.transform = 'translate(-50%, -50%)'; // Corregir posición
  
  noCancelButton.addEventListener('click', () => {
    selectedSeatsCancel.forEach((seat) => {
      const button = document.getElementsByName(`${seat}`)[0];
      button.style.backgroundColor = 'red';
    });
    noCancelButton.style.display = 'none';
    cancelButton2.style.display = 'none';
    selectedSeatsCancel.length = 0;
    Ocultar4();
  });

  document.body.appendChild(noCancelButton); // Agregamos el botón al body
}


 

function Cancelar_Reserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  selectedSeatsCancel.forEach(asiento => {
    fetch(`${urlBase}/theatres/${Cineid}/auditoriums/${auditoriumId}/showtimes/${showtimeId}/reserve`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ seat: asiento })
    })
   .then(response => {
      if (response.ok) {
        return response.json();
      } else {
        throw new Error(response.statusText);
      }
    })
   .then(data => {
      console.log(`Asiento liberado exitosamente, Asiento Liberado:${asiento}`);
      const button = document.getElementsByName(`${asiento}`)[0];
      button.style.backgroundColor = 'green';
    })
   .catch(error => {
      if (error.status === 400) {
        console.error(`El asiento o butaca a liberar no ha sido proporcionado.`);
      } else if (error.status === 409) {
        console.error(`El asiento o butaca a liberar no se encuentra ocupado, Asiento usado:${asiento}`);
      } else {
        console.error(`Error desconocido: ${error}`);
      }
    });
  });
}

 function Realiza_Reserva(salaName, hora, showtimeId, auditoriumId, Cineid, nombre){
  Ocultar4();
  console.log(`${selectedSeats}`)
  selectedSeats.forEach(seat2 => {
  fetch(`${urlBase}/theatres/${Cineid}/auditoriums/${auditoriumId}/showtimes/${showtimeId}/reserve`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ seat: seat2  })
})
.then(response => {
  if (response.ok) {
    return response.json();
  } else {
    throw new Error(response.statusText);
  }
})
.then(data => {
  console.log(`Asiento reservado exitosamente, Asiento Reservado:${seat2 }`);
  const button = document.getElementsByName(`${seat2}`)[0];
  button.style.backgroundColor = 'red';
  //Llama a la funcion de mostrar el resumen de la reserva
  const asientosSeleccionados = document.getElementsByName('Reservar');
  //mostrarResumenDeReserva(seat2,salaName,hora,showtimeId,auditoriumId,Cineid,nombre);
  Ocultar4();
})
.catch(error => {
  if (error.status === 400) {
    console.error(`El asiento o butaca a reservar no ha sido proporcionado.`);
  } else if (error.status === 409) {
    console.error(`El asiento o butaca a reservar ya se encuentra ocupado, Asiento usado:${seat2 }`);
  } else {
    console.error(`Error desconocido: ${error}`);
  }
});
});
 }

 function suscribirseAActualizaciones(salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  const eventSource = new EventSource(`${urlBase}/theatres/${Cineid}/auditoriums/${auditoriumId}/showtimes/${showtimeId}/reservation-updates`);

  eventSource.onmessage = (event) => {
    const data = JSON.parse(event.data);
    console.log(`Received update: ${data.message}`);
    // Procesar la actualización aquí
    if (data.result === 'SEAT_RESERVED') {
      // Mostrar que el asiento ha sido reservado
      const button = document.getElementsByName(`${data.seat}`)[0];
      button.style.backgroundColor = 'red';
    } else if (data.result === 'SEAT_RELEASED') {
      // Mostrar que el asiento ha sido liberado
      const button = document.getElementsByName(`${data.seat}`)[0];
      button.style.backgroundColor = 'green';
    }
  };

  eventSource.onopen = () => {
    console.log('Connected to the server');
  };

  eventSource.onerror = (event) => {
    console.error('Error occurred:', event);
  };

  eventSource.onclose = () => {
    console.log('Connection closed');
  };
}





//Va a mostrar las butacas seleccionadas refelajadas como tickets y una seccion de chucherias
function mostrarResumenDeReserva(selectedSeats, salaName, hora, showtimeId, auditoriumId, Cineid, nombre) {
  // Muestra la cantidad de butacas seleccionadas
  const numAsientos = selectedSeats.length;
  const resumenAsientos = document.createElement('p');
  resumenAsientos.textContent = `Has seleccionado ${numAsientos} butacas para la función de ${nombre} en la sala ${salaName} a las ${hora}.`;
  document.body.appendChild(resumenAsientos);

  // Mostrar selección de chucherías
  const chucherias = [
    { nombre: 'Palomitas', precio: 5 },
    { nombre: 'Refresco', precio: 3 },
    { nombre: 'Chocolate', precio: 4 },
    { nombre: 'Nachos', precio: 6 }
  ];
  console.log(chucherias);

  const seleccionChucherias = document.createElement('div');
  seleccionChucherias.innerHTML = '<h2>Seleccione sus chucherías</h2>';
  chucherias.forEach(chucheria => {
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.name = chucheria.nombre;
    checkbox.value = chucheria.precio;

    const label = document.createElement('label');
    label.textContent = chucheria.nombre;
    label.appendChild(checkbox);

    seleccionChucherias.appendChild(label);
  });

  document.body.appendChild(seleccionChucherias);

  // Agregar un botón para finalizar la compra
  const finalizarCompra = document.createElement('button');
  finalizarCompra.textContent = 'Finalizar compra';
  finalizarCompra.addEventListener('click', () => {
    // Procesar la compra aquí
    console.log('Compra finalizada');
  });

  document.body.appendChild(finalizarCompra);
}



function ComprobarExistenciaArray(asiento, Array){
 

}

    </script>
</body>
</html>
